import{i as $e,a as _e,l as M,r as Qe,b as Je,R as ti,c as ve,h as ei,d as Pe,F as ii,e as ye,f as Ee,g as jt,j as Se,k as si,m as ni,n as oi,o as O,p as ri,_ as h,q as ai,s as rt,t as B,u as st,v as hi,w as y,V as q,x as ci,M as li,G as di,y as H,z as ut,A as Q,B as be,T as Ot,C as ui,D as Gt,E as Et,H as pi,I as gi,J as fi,K as St,L as mi,N as Zt,O as wi,P as _i,Q as Ht,S as Me,U as bt,W as Te,X as Le,Y as x,Z as At,$ as Re,a0 as vi,a1 as Pi,a2 as yi,a3 as Ei,a4 as Mt,a5 as Ce,a6 as Y,a7 as ke,a8 as W,a9 as J,aa as k,ab as Si,ac as Tt,ad as bi,ae as ft,af as Mi,ag as qt,ah as Ti,ai as Li,aj as mt,ak as Ri,al as Ci,am as ki,an as xi,ao as Ii,ap as Vi,aq as Di,ar as Oi,as as ht}from"./tesselator.8BwnEGKI.js";import{av as br,ax as Mr,aw as Tr,at as Lr,aE as Rr,au as Cr,aI as kr,aG as xr,aF as Ir,aH as Vr,aC as Dr,aD as Or,aA as Ar,aB as zr,ay as Fr,az as Nr}from"./tesselator.8BwnEGKI.js";const Ai="3.4.14",{_parseImageNode:zi}=globalThis,Lt=typeof Image<"u",Rt=typeof ImageBitmap<"u",Fi=!!zi,Ct=$e?!0:Fi;function Ni(o){switch(o){case"auto":return Rt||Lt||Ct;case"imagebitmap":return Rt;case"image":return Lt;case"data":return Ct;default:throw new Error("@loaders.gl/images: image ".concat(o," not supported in this environment"))}}function Ui(){if(Rt)return"imagebitmap";if(Lt)return"image";if(Ct)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Bi(o){const t=Gi(o);if(!t)throw new Error("Not an image");return t}function ji(o){switch(Bi(o)){case"data":return o;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=o.width,t.height=o.height,e.drawImage(o,0,0),e.getImageData(0,0,o.width,o.height);default:throw new Error("getImageData")}}function Gi(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&o instanceof Image?"image":o&&typeof o=="object"&&o.data&&o.width&&o.height?"data":null}const Zi=/^data:image\/svg\+xml/,Hi=/\.svg((\?|#).*)?$/;function zt(o){return o&&(Zi.test(o)||Hi.test(o))}function qi(o,t){if(zt(t)){let i=new TextDecoder().decode(o);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(n){throw new Error(n.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return xe(o,t)}function xe(o,t){if(zt(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(o)])}async function Ie(o,t,e){const i=qi(o,e),s=self.URL||self.webkitURL,n=typeof i!="string"&&s.createObjectURL(i);try{return await Yi(n||i,t)}finally{n&&s.revokeObjectURL(n)}}async function Yi(o,t){const e=new Image;return e.src=o,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((i,s)=>{try{e.onload=()=>i(e),e.onerror=n=>s(new Error("Could not load image ".concat(o,": ").concat(n)))}catch(n){s(n)}})}const Xi={};let Yt=!0;async function Wi(o,t,e){let i;zt(e)?i=await Ie(o,t,e):i=xe(o,e);const s=t&&t.imagebitmap;return await Ki(i,s)}async function Ki(o){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(($i(t)||!Yt)&&(t=null),t)try{return await createImageBitmap(o,t)}catch(e){console.warn(e),Yt=!1}return await createImageBitmap(o)}function $i(o){for(const t in o||Xi)return!1;return!0}function Qi(o){return!is(o,"ftyp",4)||!(o[8]&96)?null:Ji(o)}function Ji(o){switch(ts(o,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function ts(o,t,e){return String.fromCharCode(...o.slice(t,e))}function es(o){return[...o].map(t=>t.charCodeAt(0))}function is(o,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=es(t);for(let s=0;s<i.length;++s)if(i[s]!==o[s+e])return!1;return!0}const C=!1,$=!0;function Ve(o){const t=tt(o);return ns(t)||as(t)||os(t)||rs(t)||ss(t)}function ss(o){const t=new Uint8Array(o instanceof DataView?o.buffer:o),e=Qi(t);return e?{mimeType:e.mimeType,width:0,height:0}:null}function ns(o){const t=tt(o);return t.byteLength>=24&&t.getUint32(0,C)===2303741511?{mimeType:"image/png",width:t.getUint32(16,C),height:t.getUint32(20,C)}:null}function os(o){const t=tt(o);return t.byteLength>=10&&t.getUint32(0,C)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,$),height:t.getUint16(8,$)}:null}function rs(o){const t=tt(o);return t.byteLength>=14&&t.getUint16(0,C)===16973&&t.getUint32(2,$)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,$),height:t.getUint32(22,$)}:null}function as(o){const t=tt(o);if(!(t.byteLength>=3&&t.getUint16(0,C)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:s}=hs();let n=2;for(;n+9<t.byteLength;){const r=t.getUint16(n,C);if(s.has(r))return{mimeType:"image/jpeg",height:t.getUint16(n+5,C),width:t.getUint16(n+7,C)};if(!i.has(r))return null;n+=2,n+=t.getUint16(n,C)}return null}function hs(){const o=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)o.add(e);return{tableMarkers:o,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function tt(o){if(o instanceof DataView)return o;if(ArrayBuffer.isView(o))return new DataView(o.buffer);if(o instanceof ArrayBuffer)return new DataView(o);throw new Error("toDataView")}async function cs(o,t){const{mimeType:e}=Ve(o)||{},i=globalThis._parseImageNode;return _e(i),await i(o,e)}async function ls(o,t,e){t=t||{};const s=(t.image||{}).type||"auto",{url:n}=e||{},r=ds(s);let a;switch(r){case"imagebitmap":a=await Wi(o,t,n);break;case"image":a=await Ie(o,t,n);break;case"data":a=await cs(o);break;default:_e(!1)}return s==="data"&&(a=ji(a)),a}function ds(o){switch(o){case"auto":case"data":return Ui();default:return Ni(o),o}}const us=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],ps=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],gs={image:{type:"auto",decode:!0}},fs={id:"image",module:"images",name:"Images",version:Ai,mimeTypes:ps,extensions:us,parse:ls,tests:[o=>!!Ve(new DataView(o))],options:gs};function ms(o){const t=o[0],e=o[o.length-1];return t==="{"&&e==="}"||t==="["&&e==="]"}const ws={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:ms,parseTextSync:JSON.parse};function _s(){const o="8.9.32",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==o)throw new Error("deck.gl - multiple versions detected: ".concat(t," vs ").concat(o));return t||(M.log(1,"deck.gl ".concat(o))(),globalThis.deck={...globalThis.deck,VERSION:o,version:o,log:M,_registerLoggers:Qe},Je([ws,[fs,{imagebitmap:{premultiplyAlpha:"none"}}]])),o}const vs=_s();function Ps(o){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(o):setTimeout(o,1e3/60)}function ys(o){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(o):clearTimeout(o)}const Es=34918,Ss=34919,bs=35007,Ms=36795,Ts=35976,Ls=35887,Rs=36202;class ct extends ti{get[Symbol.toStringTag](){return"Query"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=ve(t),s=ei(t,ii.TIMER_QUERY);let n=i||s;for(const r of e)switch(r){case"queries":n=n&&i;break;case"timers":n=n&&s;break;default:Pe(!1)}return n}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(bs)}beginOcclusionQuery(){let{conservative:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(t?Rs:Ls)}beginTransformFeedbackQuery(){return this.begin(Ts)}begin(t){return this._queryPending?this:(this.target=t,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl2.getQueryParameter(this.handle,Ss);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl2.getParameter(Ms)}getResult(){return this.gl2.getQueryParameter(this.handle,Es)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise((i,s)=>{const n=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):e++>t?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(n)};requestAnimationFrame(n)}),this._pollingPromise}_createHandle(){return ct.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}const Xt=ri()&&typeof document<"u";let Cs=0;class ks{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:e=w=>ye(w),onAddHTML:i=null,onInitialize:s=()=>{},onRender:n=()=>{},onFinalize:r=()=>{},onError:a,gl:c=null,glOptions:l={},debug:d=!1,createFramebuffer:u=!1,autoResizeViewport:p=!0,autoResizeDrawingBuffer:g=!0,stats:f=Ee.get("animation-loop-".concat(Cs++))}=t;let{useDevicePixels:m=!0}=t;"useDevicePixelRatio"in t&&(jt.deprecated("useDevicePixelRatio","useDevicePixels")(),m=t.useDevicePixelRatio),this.props={onCreateContext:e,onAddHTML:i,onInitialize:s,onRender:n,onFinalize:r,onError:a,gl:c,glOptions:l,debug:d,createFramebuffer:u},this.gl=c,this.needsRedraw=null,this.timeline=null,this.stats=f,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:p,autoResizeDrawingBuffer:g,useDevicePixels:m}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(t){return Pe(typeof t=="string"),this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}start(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const e=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(t),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=ct.isSupported(this.gl,["timers"])?new ct(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&e.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(t);return i?Number(i.value):e}setViewParameters(){return jt.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const t=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(t))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(t)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=Xt?new Promise((t,e)=>{if(Xt&&document.readyState==="complete"){t(document);return}window.addEventListener("load",()=>{t(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_cancelAnimationFrame(t){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(t):ys(t)}_requestAnimationFrame(t){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(t):Ps(t)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:t,height:e,aspect:i}=this._getSizeAndAspect();(t!==this.animationProps.width||e!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(t){typeof t=="object"&&t!==null&&(this.animationProps=Object.assign({},this.animationProps,t))}_createWebGLContext(t){if(this.offScreen=t.canvas&&typeof OffscreenCanvas<"u"&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?Se(this.props.gl,t):this.onCreateContext(t),!si(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");ni(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);const i=this.props.onAddHTML(e);i&&(e.innerHTML=i)}}_getSizeAndAspect(){const t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight;let i=1;const{canvas:s}=this.gl;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:t>0&&e>0&&(i=t/e),{width:t,height:e,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&oi(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new O(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:t}=this.gl;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}_onMouseleave(t){this.animationProps._mousePosition=null}}const Wt=1e-6,xs=6371e3;class pt{constructor({phi:t=0,theta:e=0,radius:i=1,bearing:s,pitch:n,altitude:r,radiusScale:a=xs}={}){h(this,"phi",void 0),h(this,"theta",void 0),h(this,"radius",void 0),h(this,"radiusScale",void 0),this.phi=t,this.theta=e,this.radius=i||r||1,this.radiusScale=a||1,s!==void 0&&(this.bearing=s),n!==void 0&&(this.pitch=n),this.check()}toString(){return this.formatString(ai)}formatString({printTypes:t=!1}){const e=ci;return"".concat(t?"Spherical":"","[rho:").concat(e(this.radius),",theta:").concat(e(this.theta),",phi:").concat(e(this.phi),"]")}equals(t){return rt(this.radius,t.radius)&&rt(this.theta,t.theta)&&rt(this.phi,t.phi)}exactEquals(t){return this.radius===t.radius&&this.theta===t.theta&&this.phi===t.phi}get bearing(){return 180-B(this.phi)}set bearing(t){this.phi=Math.PI-st(t)}get pitch(){return B(this.theta)}set pitch(t){this.theta=st(t)}get longitude(){return B(this.phi)}get latitude(){return B(this.theta)}get lng(){return B(this.phi)}get lat(){return B(this.theta)}get z(){return(this.radius-1)*this.radiusScale}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this.check()}clone(){return new pt().copy(this)}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this.check()}fromLngLatZ([t,e,i]){return this.radius=1+i/this.radiusScale,this.phi=st(e),this.theta=st(t),this.check()}fromVector3(t){return this.radius=hi(t),this.radius>0&&(this.theta=Math.atan2(t[0],t[1]),this.phi=Math.acos(y(t[2]/this.radius,-1,1))),this.check()}toVector3(){return new q(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}makeSafe(){return this.phi=Math.max(Wt,Math.min(Math.PI-Wt,this.phi)),this}check(){if(!Number.isFinite(this.phi)||!Number.isFinite(this.theta)||!(this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}}let Is=1,Vs=1;class De{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(t){const{delay:e=0,duration:i=Number.POSITIVE_INFINITY,rate:s=1,repeat:n=1}=t,r=Is++,a={time:0,delay:e,duration:i,rate:s,repeat:n};return this._setChannelTime(a,this.time),this.channels.set(r,a),r}removeChannel(t){this.channels.delete(t);for(const[e,i]of this.animations)i.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return e===void 0?!1:this.time>=e.delay+e.duration*e.repeat}getTime(t){if(t===void 0)return this.time;const e=this.channels.get(t);return e===void 0?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const s of e)this._setChannelTime(s,this.time);const i=this.animations.values();for(const s of i){const{animation:n,channel:r}=s;n.setTime(this.getTime(r))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const i=Vs++;return this.animations.set(i,{animation:t,channel:e}),t.setTime(this.getTime(e)),i}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const i=e-t.delay,s=t.duration*t.repeat;i>=s?t.time=t.duration*t.rate:(t.time=Math.max(0,i)%t.duration,t.time*=t.rate)}}const Ds=`attribute vec2 aClipSpacePosition;
attribute vec2 aTexCoord;
attribute vec2 aCoordinate;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main(void) {
  gl_Position = vec4(aClipSpacePosition, 0., 1.);
  position = aClipSpacePosition;
  coordinate = aCoordinate;
  uv = aTexCoord;
}
`,Kt=[-1,-1,1,-1,-1,1,1,1];class Os extends li{constructor(t,e){const i=Kt.map(s=>s===-1?0:s);super(t,Object.assign({},e,{vs:Ds,geometry:new di({drawMode:5,vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(Kt)},aTexCoord:{size:2,value:new Float32Array(i)},aCoordinate:{size:2,value:new Float32Array(i)}}})})),this.setVertexCount(4)}}const As=[255,255,255],zs=1;let Fs=0;class Ns{constructor(t={}){h(this,"id",void 0),h(this,"color",void 0),h(this,"intensity",void 0),h(this,"type","ambient");const{color:e=As}=t,{intensity:i=zs}=t;this.id=t.id||"ambient-".concat(Fs++),this.color=e,this.intensity=i}}const Us=[255,255,255],Bs=1,js=[0,0,-1];let Gs=0;class kt{constructor(t={}){h(this,"id",void 0),h(this,"color",void 0),h(this,"intensity",void 0),h(this,"type","directional"),h(this,"direction",void 0),h(this,"shadow",void 0);const{color:e=Us}=t,{intensity:i=Bs}=t,{direction:s=js}=t,{_shadow:n=!1}=t;this.id=t.id||"directional-".concat(Gs++),this.color=e,this.intensity=i,this.type="directional",this.direction=new q(s).normalize().toArray(),this.shadow=n}getProjectedLight(t){return this}}class Oe{constructor(t,e={id:"pass"}){h(this,"id",void 0),h(this,"gl",void 0),h(this,"props",void 0);const{id:i}=e;this.id=i,this.gl=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class Ft extends Oe{constructor(...t){super(...t),h(this,"_lastRenderIndex",-1)}render(t){const e=this.gl;return H(e,{framebuffer:t.target}),this._drawLayers(t)}_drawLayers(t){const{target:e,moduleParameters:i,viewports:s,views:n,onViewportActive:r,clearStack:a=!0,clearCanvas:c=!0}=t;t.pass=t.pass||"unknown";const l=this.gl;c&&Hs(l,e),a&&(this._lastRenderIndex=-1);const d=[];for(const u of s){const p=n&&n[u.id];r==null||r(u);const g=this._getDrawLayerParams(u,t),f=u.subViewports||[u];for(const m of f){const w=this._drawLayersInViewport(l,{target:e,moduleParameters:i,viewport:m,view:p,pass:t.pass,layers:t.layers},g);d.push(w)}}return d}_getDrawLayerParams(t,{layers:e,pass:i,isPicking:s=!1,layerFilter:n,cullRect:r,effects:a,moduleParameters:c},l=!1){const d=[],u=Ae(this._lastRenderIndex+1),p={layer:e[0],viewport:t,isPicking:s,renderPass:i,cullRect:r},g={};for(let f=0;f<e.length;f++){const m=e[f],w=this._shouldDrawLayer(m,p,n,g),_={shouldDrawLayer:w};w&&!l&&(_.layerRenderIndex=u(m,w),_.moduleParameters=this._getModuleParameters(m,a,i,c),_.layerParameters=this.getLayerParameters(m,f,t)),d[f]=_}return d}_drawLayersInViewport(t,{layers:e,moduleParameters:i,pass:s,target:n,viewport:r,view:a},c){const l=Zs(t,{moduleParameters:i,target:n,viewport:r});if(a&&a.props.clear){const u=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;ut(t,{scissorTest:!0,scissor:l},()=>be(t,u))}const d={totalCount:e.length,visibleCount:0,compositeCount:0,pickableCount:0};H(t,{viewport:l});for(let u=0;u<e.length;u++){const p=e[u],{shouldDrawLayer:g,layerRenderIndex:f,moduleParameters:m,layerParameters:w}=c[u];if(g&&p.props.pickable&&d.pickableCount++,p.isComposite)d.compositeCount++;else if(g){d.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,f),m.viewport=r;try{p._drawLayer({moduleParameters:m,uniforms:{layerIndex:f},parameters:w})}catch(_){p.raiseError(_,"drawing ".concat(p," to ").concat(s))}}}return d}shouldDrawLayer(t){return!0}getModuleParameters(t,e){return null}getLayerParameters(t,e,i){return t.props.parameters}_shouldDrawLayer(t,e,i,s){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;e.layer=t;let r=t.parent;for(;r;){if(!r.props.visible||!r.filterSubLayer(e))return!1;e.layer=r,r=r.parent}if(i){const a=e.layer.id;if(a in s||(s[a]=i(e)),!s[a])return!1}return t.activateViewport(e.viewport),!0}_getModuleParameters(t,e,i,s){var n;const r=Object.assign(Object.create(((n=t.internalState)===null||n===void 0?void 0:n.propsInTransition)||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:Q(this.gl)});if(e)for(const c of e){var a;Object.assign(r,(a=c.getModuleParameters)===null||a===void 0?void 0:a.call(c,t))}return Object.assign(r,this.getModuleParameters(t,e),s)}}function Ae(o=0,t={}){const e={},i=(s,n)=>{const r=s.props._offset,a=s.id,c=s.parent&&s.parent.id;let l;if(c&&!(c in t)&&i(s.parent,!1),c in e){const d=e[c]=e[c]||Ae(t[c],t);l=d(s,n),e[a]=d}else Number.isFinite(r)?(l=r+(t[c]||0),e[a]=null):l=o;return n&&l>=o&&(o=l+1),t[a]=l,l};return i}function Zs(o,{moduleParameters:t,target:e,viewport:i}){const s=e&&e.id!=="default-framebuffer",n=t&&t.devicePixelRatio||Q(o),r=s?e.height:o.drawingBufferHeight,a=i;return[a.x*n,r-(a.y+a.height)*n,a.width*n,a.height*n]}function Hs(o,t){const e=t?t.width:o.drawingBufferWidth,i=t?t.height:o.drawingBufferHeight;H(o,{viewport:[0,0,e,i]}),o.clear(16640)}class qs extends Ft{constructor(t,e){super(t,e),h(this,"shadowMap",void 0),h(this,"depthBuffer",void 0),h(this,"fbo",void 0),this.shadowMap=new Ot(t,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new ui(t,{format:33189,width:1,height:1}),this.fbo=new O(t,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(t){const e=this.fbo;ut(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=t.viewports[0],s=Q(this.gl),n=i.width*s,r=i.height*s;(n!==e.width||r!==e.height)&&e.resize({width:n,height:r}),super.render({...t,target:e,pass:"shadow"})})}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const $t=512;function Ys(o){const{width:t,height:e,pitch:i=0}=o;let{longitude:s,latitude:n,zoom:r,bearing:a=0}=o;(s<-180||s>180)&&(s=Gt(s+180,360)-180),(a<-180||a>180)&&(a=Gt(a+180,360)-180);const c=pi(e/$t);if(r<=c)r=c,n=0;else{const l=e/2/Math.pow(2,r),d=Et([0,l])[1];if(n<d)n=d;else{const u=Et([0,$t-l])[1];n>u&&(n=u)}}return{width:t,height:e,longitude:s,latitude:n,zoom:r,pitch:i,bearing:a}}const ze=.01,Xs=["longitude","latitude","zoom"],Fe={curve:1.414,speed:1.2};function Ws(o,t,e,i){const{startZoom:s,startCenterXY:n,uDelta:r,w0:a,u1:c,S:l,rho:d,rho2:u,r0:p}=Ne(o,t,i);if(c<ze){const E={};for(const S of Xs){const L=o[S],R=t[S];E[S]=gi(L,R,e)}return E}const g=e*l,f=Math.cosh(p)/Math.cosh(p+d*g),m=a*((Math.cosh(p)*Math.tanh(p+d*g)-Math.sinh(p))/u)/c,w=1/f,_=s+mi(w),v=fi([],r,m);St(v,v,n);const P=Et(v);return{longitude:P[0],latitude:P[1],zoom:_}}function Ks(o,t,e){const i={...Fe,...e},{screenSpeed:s,speed:n,maxDuration:r}=i,{S:a,rho:c}=Ne(o,t,i),l=1e3*a;let d;return Number.isFinite(s)?d=l/(s/c):d=l/n,Number.isFinite(r)&&d>r?0:d}function Ne(o,t,e){e=Object.assign({},Fe,e);const i=e.curve,s=o.zoom,n=[o.longitude,o.latitude],r=Ht(s),a=t.zoom,c=[t.longitude,t.latitude],l=Ht(a-s),d=Zt(n),u=Zt(c),p=wi([],u,d),g=Math.max(o.width,o.height),f=g/l,m=_i(p)*r,w=Math.max(m,ze),_=i*i,v=(f*f-g*g+_*_*w*w)/(2*g*_*w),P=(f*f-g*g-_*_*w*w)/(2*f*_*w),E=Math.log(Math.sqrt(v*v+1)-v),S=Math.log(Math.sqrt(P*P+1)-P),L=(S-E)/i;return{startZoom:s,startCenterXY:d,uDelta:p,w0:g,u1:m,S:L,rho:i,rho2:_,r0:E,r1:S}}const $s=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,Qs=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Js=Le(on),tn=Le(rn),en=[0,0,0,1],sn=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function nn(o,t){const[e,i,s]=o,n=At([e,i,s],t);return Number.isFinite(s)?n:[n[0],n[1],0]}function on({viewport:o,center:t}){return new x(o.viewProjectionMatrix).invert().transform(t)}function rn({viewport:o,shadowMatrices:t}){const e=[],i=o.pixelUnprojectionMatrix,s=o.isGeospatial?void 0:1,n=[[0,0,s],[o.width,0,s],[0,o.height,s],[o.width,o.height,s],[0,0,-1],[o.width,0,-1],[0,o.height,-1],[o.width,o.height,-1]].map(r=>nn(r,i));for(const r of t){const a=r.clone().translate(new q(o.center).negate()),c=n.map(d=>a.transform(d)),l=new x().ortho({left:Math.min(...c.map(d=>d[0])),right:Math.max(...c.map(d=>d[0])),bottom:Math.min(...c.map(d=>d[1])),top:Math.max(...c.map(d=>d[1])),near:Math.min(...c.map(d=>-d[2])),far:Math.max(...c.map(d=>-d[2]))});e.push(l.multiplyRight(r))}return e}function an(o,t){const{shadowEnabled:e=!0}=o;if(!e||!o.shadowMatrices||!o.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:!!o.drawToShadowMap,shadow_uUseShadowMap:o.shadowMaps?o.shadowMaps.length>0:!1,shadow_uColor:o.shadowColor||en,shadow_uLightId:o.shadowLightId||0,shadow_uLightCount:o.shadowMatrices.length},s=Js({viewport:o.viewport,center:t.project_uCenter}),n=[],r=tn({shadowMatrices:o.shadowMatrices,viewport:o.viewport}).slice();for(let a=0;a<o.shadowMatrices.length;a++){const c=r[a],l=c.clone().translate(new q(o.viewport.center).negate());t.project_uCoordinateSystem===bt.LNGLAT&&t.project_uProjectionMode===Te.WEB_MERCATOR?(r[a]=l,n[a]=s):(r[a]=c.clone().multiplyRight(sn),n[a]=l.transform(s))}for(let a=0;a<r.length;a++)i["shadow_uViewProjectionMatrices[".concat(a,"]")]=r[a],i["shadow_uProjectCenters[".concat(a,"]")]=n[a],o.shadowMaps&&o.shadowMaps.length>0?i["shadow_uShadowMap".concat(a)]=o.shadowMaps[a]:i["shadow_uShadowMap".concat(a)]=o.dummyShadowMap;return i}const wt={name:"shadow",dependencies:[Me],vs:$s,fs:Qs,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(o={},t={})=>"viewport"in o&&(o.drawToShadowMap||o.shadowMaps&&o.shadowMaps.length>0)?an(o,t):{}},hn={color:[255,255,255],intensity:1},Qt=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],cn=[0,0,0,200/255];class Ue{constructor(t={}){h(this,"id","lighting-effect"),h(this,"props",void 0),h(this,"shadowColor",cn),h(this,"shadow",void 0),h(this,"ambientLight",void 0),h(this,"directionalLights",void 0),h(this,"pointLights",void 0),h(this,"shadowPasses",[]),h(this,"shadowMaps",[]),h(this,"dummyShadowMap",null),h(this,"programManager",void 0),h(this,"shadowMatrices",void 0),this.setProps(t)}setProps(t){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const e in t){const i=t[e];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.props=t}preRender(t,{layers:e,layerFilter:i,viewports:s,onViewportActive:n,views:r}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(t),this.programManager||(this.programManager=Re.getDefaultProgramManager(t),wt&&this.programManager.addDefaultModule(wt)),this.dummyShadowMap||(this.dummyShadowMap=new Ot(t,{width:1,height:1}));for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:e,layerFilter:i,viewports:s,onViewportActive:n,views:r,moduleParameters:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){const e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:t})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:t}))},e}cleanup(){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(wt),this.programManager=null)}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const i=new x().lookAt({eye:new q(e.direction).negate()});t.push(i)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const i=new qs(t);this.shadowPasses[e]=i,this.shadowMaps[e]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:i}=this;!t&&e.length===0&&i.length===0&&(this.ambientLight=new Ns(hn),this.directionalLights.push(new kt(Qt[0]),new kt(Qt[1])))}}const ln=[255,255,255],dn=1,un=[0,0,1],pn=[0,0,1];let gn=0;class fn{constructor(t={}){h(this,"id",void 0),h(this,"color",void 0),h(this,"intensity",void 0),h(this,"type","point"),h(this,"position",void 0),h(this,"attenuation",void 0),h(this,"projectedLight",void 0);const{color:e=ln}=t,{intensity:i=dn}=t,{position:s=pn}=t;this.id=t.id||"point-".concat(gn++),this.color=e,this.intensity=i,this.type="point",this.position=s,this.attenuation=mn(t),this.projectedLight={...this}}getProjectedLight({layer:t}){const{projectedLight:e}=this,i=t.context.viewport,{coordinateSystem:s,coordinateOrigin:n}=t.props,r=vi(this.position,{viewport:i,coordinateSystem:s,coordinateOrigin:n,fromCoordinateSystem:i.isGeospatial?bt.LNGLAT:bt.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return e.color=this.color,e.intensity=this.intensity,e.position=r,e}}function mn(o){return o.attenuation?o.attenuation:"intensity"in o?[0,0,o.intensity||0]:un}class _r extends fn{getProjectedLight({layer:t}){const{projectedLight:e}=this,i=t.context.viewport,{coordinateSystem:s,coordinateOrigin:n,modelMatrix:r}=t.props,{project_uCameraPosition:a}=Pi({viewport:i,modelMatrix:r,coordinateSystem:s,coordinateOrigin:n});return e.color=this.color,e.intensity=this.intensity,e.position=a,e}}const N=Math.PI/180,wn=1e3*60*60*24,_n=2440588,vn=2451545,lt=N*23.4397,Pn=357.5291,yn=.98560028,En=280.147,Sn=360.9856235;function bn(o,t,e){const i=N*-e,s=N*t,n=Tn(o),r=Dn(n),a=xn(n,i)-r.rightAscension;return{azimuth:Cn(a,s,r.declination),altitude:kn(a,s,r.declination)}}function Jt(o,t,e){const{azimuth:i,altitude:s}=bn(o,t,e);return[Math.sin(i)*Math.cos(s),Math.cos(i)*Math.cos(s),-Math.sin(s)]}function Mn(o){return(typeof o=="number"?o:o.getTime())/wn-.5+_n}function Tn(o){return Mn(o)-vn}function Ln(o,t){const e=o;return Math.atan2(Math.sin(e)*Math.cos(lt)-Math.tan(t)*Math.sin(lt),Math.cos(e))}function Rn(o,t){const e=o;return Math.asin(Math.sin(t)*Math.cos(lt)+Math.cos(t)*Math.sin(lt)*Math.sin(e))}function Cn(o,t,e){const i=o,s=t,n=e;return Math.atan2(Math.sin(i),Math.cos(i)*Math.sin(s)-Math.tan(n)*Math.cos(s))}function kn(o,t,e){const i=o,s=t,n=e;return Math.asin(Math.sin(s)*Math.sin(n)+Math.cos(s)*Math.cos(n)*Math.cos(i))}function xn(o,t){return N*(En+Sn*o)-t}function In(o){return N*(Pn+yn*o)}function Vn(o){const t=o,e=N*(1.9148*Math.sin(t)+.02*Math.sin(2*t)+3e-4*Math.sin(3*t)),i=N*102.9372;return t+e+i+Math.PI}function Dn(o){const t=In(o),e=Vn(t);return{declination:Rn(e,0),rightAscension:Ln(e,0)}}class vr extends kt{constructor(t){super(t),h(this,"timestamp",void 0),this.timestamp=t.timestamp}getProjectedLight({layer:t}){const{viewport:e}=t.context;if(e.resolution&&e.resolution>0){const[s,n,r]=Jt(this.timestamp,0,0);this.direction=[s,-r,n]}else{const{latitude:s,longitude:n}=e;this.direction=Jt(this.timestamp,s,n)}return this}}class te extends Oe{constructor(t,e){super(t,e),h(this,"model",void 0);const{module:i,fs:s,id:n}=e;this.model=new Os(t,{id:n,fs:s,modules:[i]})}render(t){const e=this.gl;H(e,{viewport:[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}),ut(e,{framebuffer:t.outputBuffer,clearColor:[0,0,0,0]},()=>this._renderPass(e,t))}delete(){this.model.delete(),this.model=null}_renderPass(t,e){const{inputBuffer:i}=e;be(t,{color:!0}),this.model.draw({moduleSettings:e.moduleSettings,uniforms:{texture:i,texSize:[i.width,i.height]},parameters:{depthWrite:!1,depthTest:!1}})}}class Pr{constructor(t,e={}){h(this,"id",void 0),h(this,"props",void 0),h(this,"module",void 0),h(this,"passes",void 0),this.id="".concat(t.name,"-pass"),this.props=e,yi(t),this.module=t}setProps(t){this.props=t}preRender(){}postRender(t,e){const i=this.passes||On(t,this.module,this.id);this.passes=i;const{target:s}=e;let n=e.inputBuffer,r=e.swapBuffer;for(let a=0;a<this.passes.length;a++){s&&a===this.passes.length-1&&(r=s),this.passes[a].render({inputBuffer:n,outputBuffer:r,moduleSettings:this.props});const c=r;r=n,n=c}return n}cleanup(){if(this.passes){for(const t of this.passes)t.delete();this.passes=void 0}}}function On(o,t,e){if(!t.passes){const i=ee(t);return[new te(o,{id:e,module:t,fs:i})]}return t.passes.map((i,s)=>{const n=ee(t,i),r="".concat(e,"-").concat(s);return new te(o,{id:r,module:t,fs:n})})}const An=o=>`uniform sampler2D texture;
uniform vec2 texSize;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main() {
  vec2 texCoord = coordinate;

  gl_FragColor = texture2D(texture, texCoord);
  gl_FragColor = `.concat(o,`(gl_FragColor, texSize, texCoord);
}
`),zn=o=>`uniform sampler2D texture;
uniform vec2 texSize;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main() {
  vec2 texCoord = coordinate;

  gl_FragColor = `.concat(o,`(texture, texSize, texCoord);
}
`);function ee(o,t=o){if(t.filter){const e=typeof t.filter=="string"?t.filter:"".concat(o.name,"_filterColor");return An(e)}if(t.sampler){const e=typeof t.sampler=="string"?t.sampler:"".concat(o.name,"_sampleColor");return zn(e)}return null}const ie={blendFunc:[1,0,32771,0],blendEquation:32774};class Be extends Ft{constructor(...t){super(...t),h(this,"pickZ",void 0),h(this,"_colorEncoderState",null)}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:e,views:i,viewports:s,onViewportActive:n,pickingFBO:r,deviceRect:{x:a,y:c,width:l,height:d},cullRect:u,effects:p,pass:g="picking",pickZ:f,moduleParameters:m}){const w=this.gl;this.pickZ=f;const _=this._resetColorEncoder(f),v=ut(w,{scissorTest:!0,scissor:[a,c,l,d],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...ie,blend:!f},()=>super.render({target:r,layers:t,layerFilter:e,views:i,viewports:s,onViewportActive:n,cullRect:u,effects:p==null?void 0:p.filter(E=>E.useInPicking),pass:g,isPicking:!0,moduleParameters:m}));return this._colorEncoderState=null,{decodePickingColor:_&&Nn.bind(null,_),stats:v}}shouldDrawLayer(t){const{pickable:e,operation:i}=t.props;return e&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(t,e,i){const s={...t.props.parameters},{pickable:n,operation:r}=t.props;return this._colorEncoderState?n&&r.includes("draw")&&(Object.assign(s,ie),s.blend=!0,s.blendColor=Fn(this._colorEncoderState,t,i)):s.blend=!1,r.includes("terrain")&&(s.blend=!1),s}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function Fn(o,t,e){const{byLayer:i,byAlpha:s}=o;let n,r=i.get(t);return r?(r.viewports.push(e),n=r.a):(n=i.size+1,n<=255?(r={a:n,layer:t,viewports:[e]},i.set(t,r),s[n]=r):(M.warn("Too many pickable layers, only picking the first 255")(),n=0)),[0,0,0,n/255]}function Nn(o,t){const e=o.byAlpha[t[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(t)}}class Un{constructor(t,e,i){h(this,"id",void 0),h(this,"context",void 0),h(this,"isLoaded",void 0),h(this,"persistent",void 0),h(this,"_loadCount",0),h(this,"_subscribers",new Set),h(this,"_data",void 0),h(this,"_loader",void 0),h(this,"_error",void 0),h(this,"_content",void 0),this.id=t,this.context=i,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t===this._data&&!e)return;this._data=t;const i=++this._loadCount;let s=t;typeof t=="string"&&(s=Ei(t)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(n=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=n)}).catch(n=>{this._loadCount===i&&(this.isLoaded=!0,this._error=n||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const n of this._subscribers)n.onChange(this.getData())}}class Bn{constructor({gl:t,protocol:e}){h(this,"protocol",void 0),h(this,"_context",void 0),h(this,"_resources",void 0),h(this,"_consumers",void 0),h(this,"_pruneRequest",void 0),this.protocol=e||"resource://",this._context={gl:t,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:e,forceUpdate:i=!1,persistent:s=!0}){let n=this._resources[t];n?n.setData(e,i):(n=new Un(t,e,this._context),this._resources[t]=n),n.persistent=s}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){const e=this._consumers[t];if(e){for(const i in e){const s=e[i],n=this._resources[s.resourceId];n&&n.unsubscribe(s)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:e,consumerId:i,requestId:s="default"}){const{_resources:n,protocol:r}=this;t.startsWith(r)&&(t=t.replace(r,""),n[t]||this.add({resourceId:t,data:null,persistent:!1}));const a=n[t];if(this._track(i,s,a,e),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,i,s){const n=this._consumers,r=n[t]=n[t]||{},a=r[e]||{},c=a.resourceId&&this._resources[a.resourceId];c&&(c.unsubscribe(a),this.prune()),i&&(r[e]=a,a.onChange=s,a.resourceId=i.id,i.subscribe(a))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];!e.persistent&&!e.inUse()&&(e.delete(),delete this._resources[t])}}}const jn=[Me],Gn=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function Zn(o){const t=Re.getDefaultProgramManager(o);for(const e of jn)t.addDefaultModule(e);for(const e of Gn)t.addShaderHook(e);return t}const Hn="layerManager.setLayers",qn="layerManager.activateViewport";class Yn{constructor(t,{deck:e,stats:i,viewport:s,timeline:n}={}){h(this,"layers",void 0),h(this,"context",void 0),h(this,"resourceManager",void 0),h(this,"_lastRenderedLayers",[]),h(this,"_needsRedraw",!1),h(this,"_needsUpdate",!1),h(this,"_nextLayers",null),h(this,"_debug",!1),h(this,"activateViewport",r=>{Mt(qn,this,r),r&&(this.context.viewport=r)}),this.layers=[],this.resourceManager=new Bn({gl:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:t,deck:e,programManager:t&&Zn(t),stats:i||new Ce({id:"deck.gl"}),viewport:s||new Y({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:n||new De,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const s=i.getNeedsRedraw(t);e=e||s}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(e=>t.find(i=>e.id.indexOf(i)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){Mt(Hn,this,e,t),this._lastRenderedLayers=t;const i=ke(t,Boolean);for(const s of i)s.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}_handleError(t,e,i){i.raiseError(e,"".concat(t," of ").concat(i))}_updateLayers(t,e){const i={};for(const r of t)i[r.id]?M.warn("Multiple old layers with same id ".concat(r.id))():i[r.id]=r;const s=[];this._updateSublayersRecursively(e,i,s),this._finalizeOldLayers(i);let n=!1;for(const r of s)if(r.hasUniformTransition()){n="Uniform transition in ".concat(r);break}this._needsUpdate=n,this.layers=s}_updateSublayersRecursively(t,e,i){for(const s of t){s.context=this.context;const n=e[s.id];n===null&&M.warn("Multiple new layers with same id ".concat(s.id))(),e[s.id]=null;let r=null;try{this._debug&&n!==s&&s.validateProps(),n?(this._transferLayerState(n,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),r=s.isComposite?s.getSubLayers():null}catch(a){this._handleError("matching",a,s)}r&&this._updateSublayersRecursively(r,e,i)}}_finalizeOldLayers(t){for(const e in t){const i=t[e];i&&this._finalizeLayer(i)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=W.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=W.MATCHED,e!==t&&(t.lifecycle=W.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle=W.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=W.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}class Xn{constructor(t){h(this,"width",void 0),h(this,"height",void 0),h(this,"views",void 0),h(this,"viewState",void 0),h(this,"controllers",void 0),h(this,"timeline",void 0),h(this,"_viewports",void 0),h(this,"_viewportMap",void 0),h(this,"_isUpdating",void 0),h(this,"_needsRedraw",void 0),h(this,"_needsUpdate",void 0),h(this,"_eventManager",void 0),h(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const e=this.controllers[t];e&&e.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return this.views.find(e=>e.id===t)}getViewState(t){const e=typeof t=="string"?this.getView(t):t,i=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(i):i}getViewport(t){return this._viewportMap[t]}unproject(t,e){const i=this.getViewports(),s={x:t[0],y:t[1]};for(let n=i.length-1;n>=0;--n){const r=i[n];if(r.containsPixel(s)){const a=t.slice();return a[0]-=r.x,a[1]-=r.y,r.unproject(a,e)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=ke(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!J(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):M.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(t,e){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...e,viewId:t})}_createController(t,e){const i=e.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,e.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:n=>{var r;return(r=this.getView(t.id))===null||r===void 0?void 0:r.makeViewport({viewState:n,width:this.width,height:this.height})}})}_updateController(t,e,i,s){const n=t.controller;if(n&&i){const r={...e,...n,id:t.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!s||s.constructor!==n.type)&&(s=this._createController(t,r)),s&&s.setProps(r),s}return null}_rebuildViewports(){const{views:t}=this,e=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let s=t.length;s--;){const n=t[s],r=this.getViewState(n),a=n.makeViewport({viewState:r,width:this.width,height:this.height});let c=e[n.id];const l=!!n.controller;l&&!c&&(i=!0),(i||!l)&&c&&(c.finalize(),c=null),this.controllers[n.id]=this._updateController(n,r,a,c),a&&this._viewports.unshift(a)}for(const s in e){const n=e[s];n&&!this.controllers[s]&&n.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,e){return t.length!==e.length?!0:t.some((i,s)=>!t[s].equals(e[s]))}}const Wn=/([0-9]+\.?[0-9]*)(%|px)/;function I(o){switch(typeof o){case"number":return{position:o,relative:!1};case"string":const t=Wn.exec(o);if(t&&t.length>=3){const e=t[2]==="%",i=parseFloat(t[1]);return{position:e?i/100:i,relative:e}}default:throw new Error("Could not parse position string ".concat(o))}}function V(o,t){return o.relative?Math.round(o.position*t):o.position}class et{constructor(t){h(this,"id",void 0),h(this,"viewportInstance",void 0),h(this,"_x",void 0),h(this,"_y",void 0),h(this,"_width",void 0),h(this,"_height",void 0),h(this,"_padding",void 0),h(this,"props",void 0);const{id:e,x:i=0,y:s=0,width:n="100%",height:r="100%",padding:a=null,viewportInstance:c}=t||{};k(!c||c instanceof Y),this.viewportInstance=c,this.id=e||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=I(i),this._y=I(s),this._width=I(n),this._height=I(r),this._padding=a&&{left:I(a.left||0),right:I(a.right||0),top:I(a.top||0),bottom:I(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.viewportInstance?t.viewportInstance?this.viewportInstance.equals(t.viewportInstance):!1:this.ViewportType===t.ViewportType&&J(this.props,t.props,2)}makeViewport({width:t,height:e,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const s=this.getDimensions({width:t,height:e});return!s.height||!s.width?null:new this.ViewportType({...i,...this.props,...s})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:(t==null?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const i in this.props.viewState)i!=="id"&&(e[i]=this.props.viewState[i]);return e}return t}getDimensions({width:t,height:e}){const i={x:V(this._x,t),y:V(this._y,e),width:V(this._width,t),height:V(this._height,e)};return this._padding&&(i.padding={left:V(this._padding.left,t),top:V(this._padding.top,e),right:V(this._padding.right,t),bottom:V(this._padding.bottom,e)}),i}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}const se=()=>{},xt={BREAK:1,SNAP_TO_END:2,IGNORE:3},Kn=o=>o,$n=xt.BREAK;class Qn{constructor(t){h(this,"getControllerState",void 0),h(this,"props",void 0),h(this,"propsInTransition",void 0),h(this,"transition",void 0),h(this,"onViewStateChange",void 0),h(this,"onStateChange",void 0),h(this,"_onTransitionUpdate",e=>{const{time:i,settings:{interpolator:s,startProps:n,endProps:r,duration:a,easing:c}}=e,l=c(i/a),d=s.interpolateProps(n,r,l);this.propsInTransition=this.getControllerState({...this.props,...d}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new Si(t.timeline),this.onViewStateChange=t.onViewStateChange||se,this.onStateChange=t.onStateChange||se}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const i=this.props;if(this.props=t,!i||this._shouldIgnoreViewportChange(i,t))return!1;if(this._isTransitionEnabled(t)){let s=i;if(this.transition.inProgress){const{interruption:n,endProps:r}=this.transition.settings;s={...i,...n===xt.SNAP_TO_END?r:this.propsInTransition||i}}this._triggerTransition(s,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:i}=t;return(e>0||e==="auto")&&!!i}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===xt.IGNORE||this._isUpdateDueToCurrentTransition(e):this._isTransitionEnabled(e)?e.transitionInterpolator.arePropsEqual(t,e):!0}_triggerTransition(t,e){const i=this.getControllerState(t),s=this.getControllerState(e).shortestPathFrom(i),n=e.transitionInterpolator,r=n.getDuration?n.getDuration(t,e):e.transitionDuration;if(r===0)return;const a=n.initializeProps(t,s);this.propsInTransition={};const c={duration:r,easing:e.transitionEasing||Kn,interpolator:n,interruption:e.transitionInterruption||$n,startProps:a.start,endProps:a.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)};this.transition.start(c),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t==null||t(e)}}}class je{constructor(t){h(this,"_propsToCompare",void 0),h(this,"_propsToExtract",void 0),h(this,"_requiredProps",void 0);const{compare:e,extract:i,required:s}=t;this._propsToCompare=e,this._propsToExtract=i||e,this._requiredProps=s}arePropsEqual(t,e){for(const i of this._propsToCompare)if(!(i in t)||!(i in e)||!rt(t[i],e[i]))return!1;return!0}initializeProps(t,e){const i={},s={};for(const n of this._propsToExtract)(n in t||n in e)&&(i[n]=t[n],s[n]=e[n]);return this._checkRequiredProps(i),this._checkRequiredProps(s),{start:i,end:s}}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(e=>{const i=t[e];k(Number.isFinite(i)||Array.isArray(i),"".concat(e," is required for transition"))})}}const Jn=["longitude","latitude","zoom","bearing","pitch"],to=["longitude","latitude","zoom"];class X extends je{constructor(t={}){const e=Array.isArray(t)?t:t.transitionProps,i=Array.isArray(t)?{}:t;i.transitionProps=Array.isArray(e)?{compare:e,required:e}:e||{compare:Jn,required:to},super(i.transitionProps),h(this,"opts",void 0),this.opts=i}initializeProps(t,e){const i=super.initializeProps(t,e),{makeViewport:s,around:n}=this.opts;if(s&&n){const r=s(t),a=s(e),c=r.unproject(n);i.start.around=n,Object.assign(i.end,{around:a.project(c),aroundPosition:c,width:e.width,height:e.height})}return i}interpolateProps(t,e,i){const s={};for(const n of this._propsToExtract)s[n]=Tt(t[n]||0,e[n]||0,i);if(e.aroundPosition&&this.opts.makeViewport){const n=this.opts.makeViewport({...e,...s});Object.assign(s,n.panByPosition(e.aroundPosition,Tt(t.around,e.around,i)))}return s}}const D={transitionDuration:0},eo=300,nt=o=>1-(1-o)*(1-o),j={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},z={};class it{constructor(t){h(this,"props",void 0),h(this,"state",{}),h(this,"transitionManager",void 0),h(this,"eventManager",void 0),h(this,"onViewStateChange",void 0),h(this,"onStateChange",void 0),h(this,"makeViewport",void 0),h(this,"_controllerState",void 0),h(this,"_events",{}),h(this,"_interactionState",{isDragging:!1}),h(this,"_customEvents",[]),h(this,"_eventStartBlocked",null),h(this,"_panMove",!1),h(this,"invertPan",!1),h(this,"dragMode","rotate"),h(this,"inertia",0),h(this,"scrollZoom",!0),h(this,"dragPan",!0),h(this,"dragRotate",!0),h(this,"doubleClickZoom",!0),h(this,"touchZoom",!0),h(this,"touchRotate",!1),h(this,"keyboard",!0),this.transitionManager=new Qn({...t,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)if(this._events[e]){var t;(t=this.eventManager)===null||t===void 0||t.off(e,this.handleEvent)}this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const e=this._eventStartBlocked;switch(t.type){case"panstart":return e?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return e?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return e?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:e,y:i}=this.props,{offsetCenter:s}=t;return[s.x-e,s.y-i]}isPointInBounds(t,e){const{width:i,height:s}=this.props;if(e&&e.handled)return!1;const n=t[0]>=0&&t[0]<=i&&t[1]>=0&&t[1]<=s;return n&&e&&e.stopPropagation(),n}isFunctionKeyPressed(t){const{srcEvent:e}=t;return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const e=setTimeout(()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=e}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:e}=t;this.inertia=Number.isFinite(e)?e:e===!0?eo:0;const{scrollZoom:i=!0,dragPan:s=!0,dragRotate:n=!0,doubleClickZoom:r=!0,touchZoom:a=!0,touchRotate:c=!1,keyboard:l=!0}=t,d=!!this.onViewStateChange;this.toggleEvents(j.WHEEL,d&&i),this.toggleEvents(j.PAN,d),this.toggleEvents(j.PINCH,d&&(a||c)),this.toggleEvents(j.TRIPLE_PAN,d&&c),this.toggleEvents(j.DOUBLE_TAP,d&&r),this.toggleEvents(j.KEYBOARD,d&&l),this.scrollZoom=i,this.dragPan=s,this.dragRotate=n,this.doubleClickZoom=r,this.touchZoom=a,this.touchRotate=c,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach(i=>{this._events[i]!==e&&(this._events[i]=e,e?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(t,e=null,i={}){const s={...t.getViewportProps(),...e},n=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(i),n){const r=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:r})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let i=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const s=this.controllerState[i?"panStart":"rotateStart"]({pos:e});return this._panMove=i,this.updateViewport(s,D,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),i=this.controllerState.pan({pos:e});return this.updateViewport(i,D,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const i=this.getCenter(t),s=[i[0]+t.velocityX*e/2,i[1]+t.velocityY*e/2],n=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:nt},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),i=this.controllerState.rotate({pos:e});return this.updateViewport(i,D,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const i=this.getCenter(t),s=[i[0]+t.velocityX*e/2,i[1]+t.velocityY*e/2],n=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:nt},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;t.srcEvent.preventDefault();const{speed:i=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:n}=t;let r=2/(1+Math.exp(-Math.abs(n*i)));n<0&&r!==0&&(r=1/r);const a=this.controllerState.zoom({pos:e,scale:r});return this.updateViewport(a,{...this._getTransitionProps({around:e}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.controllerState.rotateStart({pos:e});return this.updateViewport(i,D,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate||!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const i=this.controllerState.rotate({pos:e});return this.updateViewport(i,D,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const i=this.getCenter(t),s=[i[0],i[1]+=t.velocityY*e/2],n=this.controllerState.rotate({pos:s});this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:nt},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return z._startPinchRotation=t.rotation,z._lastPinchEvent=t,this.updateViewport(i,D,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:i}=t,s=this.getCenter(t);e=e.zoom({pos:s,scale:i})}if(this.touchRotate){const{rotation:i}=t;e=e.rotate({deltaAngleX:z._startPinchRotation-i})}return this.updateViewport(e,D,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),z._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this,{_lastPinchEvent:i}=z;if(this.touchZoom&&e&&i&&t.scale!==i.scale){const s=this.getCenter(t);let n=this.controllerState.rotateEnd();const r=Math.log2(t.scale),a=(r-Math.log2(i.scale))/(t.deltaTime-i.deltaTime),c=Math.pow(2,r+a*e/2);n=n.zoom({pos:s,scale:c}).zoomEnd(),this.updateViewport(n,{...this._getTransitionProps({around:s}),transitionDuration:e,transitionEasing:nt},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return z._startPinchRotation=null,z._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.isFunctionKeyPressed(t),s=this.controllerState.zoom({pos:e,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:n,rotateSpeedY:r}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let c;const l={};switch(t.srcEvent.code){case"Minus":c=e?a.zoomOut(i).zoomOut(i):a.zoomOut(i),l.isZooming=!0;break;case"Equal":c=e?a.zoomIn(i).zoomIn(i):a.zoomIn(i),l.isZooming=!0;break;case"ArrowLeft":e?(c=a.rotateLeft(n),l.isRotating=!0):(c=a.moveLeft(s),l.isPanning=!0);break;case"ArrowRight":e?(c=a.rotateRight(n),l.isRotating=!0):(c=a.moveRight(s),l.isPanning=!0);break;case"ArrowUp":e?(c=a.rotateUp(r),l.isRotating=!0):(c=a.moveUp(s),l.isPanning=!0);break;case"ArrowDown":e?(c=a.rotateDown(r),l.isRotating=!0):(c=a.moveDown(s),l.isPanning=!0);break;default:return!1}return this.updateViewport(c,this._getTransitionProps(),l),!0}_getTransitionProps(t){const{transition:e}=this;return!e||!e.transitionInterpolator?D:t?{...e,transitionInterpolator:new X({...t,...e.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:e}}class Nt{constructor(t,e){h(this,"_viewportProps",void 0),h(this,"_state",void 0),this._viewportProps=this.applyConstraints(t),this._state=e}getViewportProps(){return this._viewportProps}getState(){return this._state}}const ne=5,io=1.2;class Ge extends Nt{constructor(t){const{width:e,height:i,latitude:s,longitude:n,zoom:r,bearing:a=0,pitch:c=0,altitude:l=1.5,position:d=[0,0,0],maxZoom:u=20,minZoom:p=0,maxPitch:g=60,minPitch:f=0,startPanLngLat:m,startZoomLngLat:w,startRotatePos:_,startBearing:v,startPitch:P,startZoom:E,normalize:S=!0}=t;k(Number.isFinite(n)),k(Number.isFinite(s)),k(Number.isFinite(r)),super({width:e,height:i,latitude:s,longitude:n,zoom:r,bearing:a,pitch:c,altitude:l,maxZoom:u,minZoom:p,maxPitch:g,minPitch:f,normalize:S,position:d},{startPanLngLat:m,startZoomLngLat:w,startRotatePos:_,startBearing:v,startPitch:P,startZoom:E}),h(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:e}){const i=this.getState().startPanLngLat||this._unproject(e);if(!i)return this;const n=this.makeViewport(this.getViewportProps()).panByPosition(i,t);return this._getUpdatedState(n)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:e=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:n,startPitch:r}=this.getState();if(!s||n===void 0||r===void 0)return this;let a;return t?a=this._getNewRotation(t,s,r,n):a={bearing:n+e,pitch:r+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:e,scale:i}){let{startZoom:s,startZoomLngLat:n}=this.getState();if(n||(s=this.getViewportProps().zoom,n=this._unproject(e)||this._unproject(t)),!n)return this;const{maxZoom:r,minZoom:a}=this.getViewportProps();let c=s+Math.log2(i);c=y(c,a,r);const l=this.makeViewport({...this.getViewportProps(),zoom:c});return this._getUpdatedState({zoom:c,...l.panByPosition(n,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:n}=i;return Math.abs(s-e.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(n-e.longitude)>180&&(i.longitude=n<0?n+360:n-360),i}applyConstraints(t){const{maxZoom:e,minZoom:i,zoom:s}=t;t.zoom=y(s,i,e);const{maxPitch:n,minPitch:r,pitch:a}=t;t.pitch=y(a,r,n);const{normalize:c=!0}=t;return c&&Object.assign(t,Ys(t)),t}_zoomFromCenter(t){const{width:e,height:i}=this.getViewportProps();return this.zoom({pos:[e/2,i/2],scale:t})}_panFromCenter(t){const{width:e,height:i}=this.getViewportProps();return this.pan({startPos:[e/2,i/2],pos:[e/2+t[0],i/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_getNewRotation(t,e,i,s){const n=t[0]-e[0],r=t[1]-e[1],a=t[1],c=e[1],{width:l,height:d}=this.getViewportProps(),u=n/l;let p=0;r>0?Math.abs(d-c)>ne&&(p=r/(c-d)*io):r<0&&c>ne&&(p=1-a/c),p=y(p,-1,1);const{minPitch:g,maxPitch:f}=this.getViewportProps(),m=s+180*u;let w=i;return p>0?w=i+p*(f-i):p<0&&(w=i-p*(g-i)),{pitch:w,bearing:m}}}class so extends it{constructor(...t){super(...t),h(this,"ControllerState",Ge),h(this,"transition",{transitionDuration:300,transitionInterpolator:new X({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),h(this,"dragMode","pan")}setProps(t){t.position=t.position||[0,0,0];const e=this.props;super.setProps(t),(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class Ze extends et{get ViewportType(){return bi}get ControllerType(){return so}}h(Ze,"displayName","MapView");const no=new Ue;function oo(o,t){var e,i;const s=(e=o.order)!==null&&e!==void 0?e:1/0,n=(i=t.order)!==null&&i!==void 0?i:1/0;return s-n}class ro{constructor(){h(this,"effects",void 0),h(this,"_resolvedEffects",[]),h(this,"_defaultEffects",[]),h(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const e=this._defaultEffects;if(!e.find(i=>i.id===t.id)){const i=e.findIndex(s=>oo(s,t)>0);i<0?e.push(t):e.splice(i,0,t),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(J(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._resolvedEffects}_setEffects(t){const e={};for(const s of this.effects)e[s.id]=s;const i=[];for(const s of t){const n=e[s.id];n&&n!==s?n.setProps?(n.setProps(s.props),i.push(n)):(n.cleanup(),i.push(s)):i.push(s),delete e[s.id]}for(const s in e)e[s].cleanup();this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),t.some(s=>s instanceof Ue)||this._resolvedEffects.push(no),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class ao extends Ft{shouldDrawLayer(t){const{operation:e}=t.props;return e.includes("draw")||e.includes("terrain")}}const ho="deckRenderer.renderLayers";class co{constructor(t){h(this,"gl",void 0),h(this,"layerFilter",void 0),h(this,"drawPickingColors",void 0),h(this,"drawLayersPass",void 0),h(this,"pickLayersPass",void 0),h(this,"renderCount",void 0),h(this,"_needsRedraw",void 0),h(this,"renderBuffers",void 0),h(this,"lastPostProcessEffect",void 0),this.gl=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new ao(t),this.pickLayersPass=new Be(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t,target:t.target||O.getDefaultFramebuffer(this.gl)};i.effects&&this._preRender(i.effects,i);const s=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,n=e.render({...i,target:s});i.effects&&this._postRender(i.effects,i),this.renderCount++,Mt(ho,this,n,t)}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){this.lastPostProcessEffect=null,e.preRenderStats=e.preRenderStats||{};for(const i of t)e.preRenderStats[i.id]=i.preRender(this.gl,e),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this;t.length===0&&t.push(new O(this.gl),new O(this.gl));for(const e of t)e.resize()}_postRender(t,e){const{renderBuffers:i}=this,s={...e,inputBuffer:i[0],swapBuffer:i[1],target:null};for(const n of t)if(n.postRender){if(n.id===this.lastPostProcessEffect){s.target=e.target,n.postRender(this.gl,s);break}const r=n.postRender(this.gl,s);s.inputBuffer=r,s.swapBuffer=r===i[0]?i[1]:i[0]}}}const lo={pickedColor:null,pickedObjectIndex:-1};function uo({pickedColors:o,decodePickingColor:t,deviceX:e,deviceY:i,deviceRadius:s,deviceRect:n}){const{x:r,y:a,width:c,height:l}=n;let d=s*s,u=-1,p=0;for(let g=0;g<l;g++){const f=g+a-i,m=f*f;if(m>d)p+=4*c;else for(let w=0;w<c;w++){if(o[p+3]-1>=0){const v=w+r-e,P=v*v+m;P<=d&&(d=P,u=p)}p+=4}}if(u>=0){const g=o.slice(u,u+4),f=t(g);if(f){const m=Math.floor(u/4/c),w=u/4-m*c;return{...f,pickedColor:g,pickedX:r+w,pickedY:a+m}}M.error("Picked non-existent layer. Is picking buffer corrupt?")()}return lo}function po({pickedColors:o,decodePickingColor:t}){const e=new Map;if(o){for(let i=0;i<o.length;i+=4)if(o[i+3]-1>=0){const n=o.slice(i,i+4),r=n.join(",");if(!e.has(r)){const a=t(n);a?e.set(r,{...a,color:n}):M.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(e.values())}function He({pickInfo:o,viewports:t,pixelRatio:e,x:i,y:s,z:n}){let r=t[0];t.length>1&&(r=fo((o==null?void 0:o.pickedViewports)||t,{x:i,y:s}));let a;if(r){const c=[i-r.x,s-r.y];n!==void 0&&(c[2]=n),a=r.unproject(c)}return{color:null,layer:null,viewport:r,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:a,devicePixel:o&&"pickedX"in o?[o.pickedX,o.pickedY]:void 0,pixelRatio:e}}function go(o){const{pickInfo:t,lastPickedInfo:e,mode:i,layers:s}=o,{pickedColor:n,pickedLayer:r,pickedObjectIndex:a}=t,c=r?[r]:[];if(i==="hover"){const u=e.index,p=e.layerId,g=r?r.props.id:null;if(g!==p||a!==u){if(g!==p){const f=s.find(m=>m.props.id===p);f&&c.unshift(f)}e.layerId=g,e.index=a,e.info=null}}const l=He(o),d=new Map;return d.set(null,l),c.forEach(u=>{let p={...l};u===r&&(p.color=n,p.index=a,p.picked=!0),p=qe({layer:u,info:p,mode:i});const g=p.layer;u===r&&i==="hover"&&(e.info=p),d.set(g.id,p),i==="hover"&&g.updateAutoHighlight(p)}),d}function qe({layer:o,info:t,mode:e}){for(;o&&t;){const i=t.layer||null;t.sourceLayer=i,t.layer=o,t=o.getPickingInfo({info:t,mode:e,sourceLayer:i}),o=o.parent}return t}function fo(o,t){for(let e=o.length-1;e>=0;e--){const i=o[e];if(i.containsPixel(t))return i}return o[0]}class mo{constructor(t){h(this,"gl",void 0),h(this,"pickingFBO",void 0),h(this,"depthFBO",void 0),h(this,"pickLayersPass",void 0),h(this,"layerFilter",void 0),h(this,"lastPickedInfo",void 0),h(this,"_pickable",!0),this.gl=t,this.pickLayersPass=new Be(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:e,layers:i,viewports:s},n=this.lastPickedInfo.info){const r=n&&n.layer&&n.layer.id,a=n&&n.viewport&&n.viewport.id,c=r?i.find(p=>p.id===r):null,l=a&&s.find(p=>p.id===a)||s[0],d=l&&l.unproject([t-l.x,e-l.y]);return{...n,...{x:t,y:e,viewport:l,coordinate:d,layer:c}}}_resizeBuffer(){var t,e;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new O(i),O.isSupported(i,{colorBufferFloat:!0}))){const s=new O(i);s.attach({36064:new Ot(i,{format:ve(i)?34836:6408,type:5126})}),this.depthFBO=s}(t=this.pickingFBO)===null||t===void 0||t.resize({width:i.canvas.width,height:i.canvas.height}),(e=this.depthFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(t){if(this._pickable===!1)return null;const e=t.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return e.length?e:null}_pickClosestObject({layers:t,views:e,viewports:i,x:s,y:n,radius:r=0,depth:a=1,mode:c="query",unproject3D:l,onViewportActive:d,effects:u}){const p=this._getPickable(t),g=Q(this.gl);if(!p)return{result:[],emptyInfo:He({viewports:i,x:s,y:n,pixelRatio:g})};this._resizeBuffer();const f=ft(this.gl,[s,n],!0),m=[f.x+Math.floor(f.width/2),f.y+Math.floor(f.height/2)],w=Math.round(r*g),{width:_,height:v}=this.pickingFBO,P=this._getPickingRect({deviceX:m[0],deviceY:m[1],deviceRadius:w,deviceWidth:_,deviceHeight:v}),E={x:s-r,y:n-r,width:r*2+1,height:r*2+1};let S;const L=[],R=new Set;for(let A=0;A<a;A++){let b;if(P){const T=this._drawAndSample({layers:p,views:e,viewports:i,onViewportActive:d,deviceRect:P,cullRect:E,effects:u,pass:"picking:".concat(c)});b=uo({...T,deviceX:m[0],deviceY:m[1],deviceRadius:w,deviceRect:P})}else b={pickedColor:null,pickedObjectIndex:-1};let U;if(b.pickedLayer&&l&&this.depthFBO){const{pickedColors:T}=this._drawAndSample({layers:[b.pickedLayer],views:e,viewports:i,onViewportActive:d,deviceRect:{x:b.pickedX,y:b.pickedY,width:1,height:1},cullRect:E,effects:u,pass:"picking:".concat(c,":z")},!0);T[3]&&(U=T[0])}b.pickedLayer&&A+1<a&&(R.add(b.pickedLayer),b.pickedLayer.disablePickingIndex(b.pickedObjectIndex)),S=go({pickInfo:b,lastPickedInfo:this.lastPickedInfo,mode:c,layers:p,viewports:i,x:s,y:n,z:U,pixelRatio:g});for(const T of S.values())T.layer&&L.push(T);if(!b.pickedColor)break}for(const A of R)A.restorePickingColors();return{result:L,emptyInfo:S.get(null)}}_pickVisibleObjects({layers:t,views:e,viewports:i,x:s,y:n,width:r=1,height:a=1,mode:c="query",maxObjects:l=null,onViewportActive:d,effects:u}){const p=this._getPickable(t);if(!p)return[];this._resizeBuffer();const g=Q(this.gl),f=ft(this.gl,[s,n],!0),m=f.x,w=f.y+f.height,_=ft(this.gl,[s+r,n+a],!0),v=_.x+_.width,P=_.y,E={x:m,y:P,width:v-m,height:w-P},S=this._drawAndSample({layers:p,views:e,viewports:i,onViewportActive:d,deviceRect:E,cullRect:{x:s,y:n,width:r,height:a},effects:u,pass:"picking:".concat(c)}),L=po(S),R=new Map,A=Number.isFinite(l);for(let b=0;b<L.length&&!(A&&l&&R.size>=l);b++){const U=L[b];let T={color:U.pickedColor,layer:null,index:U.pickedObjectIndex,picked:!0,x:s,y:n,pixelRatio:g};T=qe({layer:U.pickedLayer,info:T,mode:c}),R.has(T.object)||R.set(T.object,T)}return Array.from(R.values())}_drawAndSample({layers:t,views:e,viewports:i,onViewportActive:s,deviceRect:n,cullRect:r,effects:a,pass:c},l=!1){const d=l?this.depthFBO:this.pickingFBO,u={layers:t,layerFilter:this.layerFilter,views:e,viewports:i,onViewportActive:s,pickingFBO:d,deviceRect:n,cullRect:r,effects:a,pass:c,pickZ:l,preRenderStats:{}};for(const v of a)v.useInPicking&&(u.preRenderStats[v.id]=v.preRender(this.gl,u));const{decodePickingColor:p}=this.pickLayersPass.render(u),{x:g,y:f,width:m,height:w}=n,_=new(l?Float32Array:Uint8Array)(m*w*4);return Mi(d,{sourceX:g,sourceY:f,sourceWidth:m,sourceHeight:w,target:_}),{pickedColors:_,decodePickingColor:p}}_getPickingRect({deviceX:t,deviceY:e,deviceRadius:i,deviceWidth:s,deviceHeight:n}){const r=Math.max(0,t-i),a=Math.max(0,e-i),c=Math.min(s,t+i+1)-r,l=Math.min(n,e+i+1)-a;return c<=0||l<=0?null:{x:r,y:a,width:c,height:l}}}const wo={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class _o{constructor(t){h(this,"el",null),h(this,"isVisible",!1);const e=t.parentElement;e&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,wo),e.appendChild(this.el))}setTooltip(t,e,i){const s=this.el;if(s){if(typeof t=="string")s.innerText=t;else if(t)t.text&&(s.innerText=t.text),t.html&&(s.innerHTML=t.html),t.className&&(s.className=t.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform="translate(".concat(e,"px, ").concat(i,"px)"),t&&typeof t=="object"&&"style"in t&&Object.assign(s.style,t.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}class vo{constructor(){this.get=()=>null,this.set=()=>this,this.on=()=>this,this.off=()=>this,this.destroy=()=>this,this.emit=()=>this}}const Po=vo;class gt{constructor(t,e,i){this.element=t,this.callback=e,this.options={enable:!0,...i}}}const yo=null,oe={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},Eo={doubletap:["tap"]},So={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Ut={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},bo={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},re={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Mo=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",G=typeof window<"u"?window:global;let It=!1;try{const o={get passive(){return It=!0,!0}};G.addEventListener("test",null,o),G.removeEventListener("test",null)}catch{It=!1}const To=Mo.indexOf("firefox")!==-1,{WHEEL_EVENTS:Lo}=Ut,ae="wheel",he=4.000244140625,Ro=40,Co=.25;class ko extends gt{constructor(t,e,i){super(t,e,i),this.handleEvent=s=>{if(!this.options.enable)return;let n=s.deltaY;G.WheelEvent&&(To&&s.deltaMode===G.WheelEvent.DOM_DELTA_PIXEL&&(n/=G.devicePixelRatio),s.deltaMode===G.WheelEvent.DOM_DELTA_LINE&&(n*=Ro)),n!==0&&n%he===0&&(n=Math.floor(n/he)),s.shiftKey&&n&&(n=n*Co),this.callback({type:ae,center:{x:s.clientX,y:s.clientY},delta:-n,srcEvent:s,pointerType:"mouse",target:s.target})},this.events=(this.options.events||[]).concat(Lo),this.events.forEach(s=>t.addEventListener(s,this.handleEvent,It?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===ae&&(this.options.enable=e)}}const{MOUSE_EVENTS:xo}=Ut,ce="pointermove",le="pointerover",de="pointerout",ue="pointerenter",pe="pointerleave";class Io extends gt{constructor(t,e,i){super(t,e,i),this.handleEvent=n=>{this.handleOverEvent(n),this.handleOutEvent(n),this.handleEnterEvent(n),this.handleLeaveEvent(n),this.handleMoveEvent(n)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,this.events=(this.options.events||[]).concat(xo),this.events.forEach(n=>t.addEventListener(n,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===ce&&(this.enableMoveEvent=e),t===le&&(this.enableOverEvent=e),t===de&&(this.enableOutEvent=e),t===ue&&(this.enableEnterEvent=e),t===pe&&(this.enableLeaveEvent=e)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(le,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(de,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(ue,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(pe,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.which===0&&(this.pressed=!1),this.pressed||this._emit(ce,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const{KEY_EVENTS:Vo}=Ut,ge="keydown",fe="keyup";class Do extends gt{constructor(t,e,i){super(t,e,i),this.handleEvent=s=>{const n=s.target||s.srcElement;n.tagName==="INPUT"&&n.type==="text"||n.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:ge,srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:fe,srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(Vo),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(s=>t.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===ge&&(this.enableDownEvent=e),t===fe&&(this.enableUpEvent=e)}}const me="contextmenu";class Oo extends gt{constructor(t,e,i){super(t,e,i),this.handleEvent=s=>{this.options.enable&&this.callback({type:me,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t===me&&(this.options.enable=e)}}const Vt=1,dt=2,Dt=4,Ao={pointerdown:Vt,pointermove:dt,pointerup:Dt,mousedown:Vt,mousemove:dt,mouseup:Dt},zo=1,Fo=2,No=3,Uo=0,Bo=1,jo=2,Go=1,Zo=2,Ho=4;function qo(o){const t=Ao[o.srcEvent.type];if(!t)return null;const{buttons:e,button:i,which:s}=o.srcEvent;let n=!1,r=!1,a=!1;return t===Dt||t===dt&&!Number.isFinite(e)?(n=s===zo,r=s===Fo,a=s===No):t===dt?(n=!!(e&Go),r=!!(e&Ho),a=!!(e&Zo)):t===Vt&&(n=i===Uo,r=i===Bo,a=i===jo),{leftButton:n,middleButton:r,rightButton:a}}function Yo(o,t){const e=o.center;if(!e)return null;const i=t.getBoundingClientRect(),s=i.width/t.offsetWidth||1,n=i.height/t.offsetHeight||1,r={x:(e.x-i.left-t.clientLeft)/s,y:(e.y-i.top-t.clientTop)/n};return{center:e,offsetCenter:r}}const _t={srcElement:"root",priority:0};class Xo{constructor(t){this.handleEvent=e=>{if(this.isEmpty())return;const i=this._normalizeEvent(e);let s=e.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,i,s=!1,n=!1){const{handlers:r,handlersByElement:a}=this;let c=_t;typeof i=="string"||i&&i.addEventListener?c={..._t,srcElement:i}:i&&(c={..._t,...i});let l=a.get(c.srcElement);l||(l=[],a.set(c.srcElement,l));const d={type:t,handler:e,srcElement:c.srcElement,priority:c.priority};s&&(d.once=!0),n&&(d.passive=!0),r.push(d),this._active=this._active||!d.passive;let u=l.length-1;for(;u>=0&&!(l[u].priority>=d.priority);)u--;l.splice(u+1,0,d)}remove(t,e){const{handlers:i,handlersByElement:s}=this;for(let n=i.length-1;n>=0;n--){const r=i[n];if(r.type===t&&r.handler===e){i.splice(n,1);const a=s.get(r.srcElement);a.splice(a.indexOf(r),1),a.length===0&&s.delete(r.srcElement)}}this._active=i.some(n=>!n.passive)}_emit(t,e){const i=this.handlersByElement.get(e);if(i){let s=!1;const n=()=>{t.handled=!0},r=()=>{t.handled=!0,s=!0},a=[];for(let c=0;c<i.length;c++){const{type:l,handler:d,once:u}=i[c];if(d({...t,type:l,stopPropagation:n,stopImmediatePropagation:r}),u&&a.push(i[c]),s)break}for(let c=0;c<a.length;c++){const{type:l,handler:d}=a[c];this.remove(l,d)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...qo(t),...Yo(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}const Wo={events:null,recognizers:null,recognizerOptions:{},Manager:Po,touchAction:"none",tabIndex:0};class Ko{constructor(t=null,e){this._onBasicInput=s=>{const{srcEvent:n}=s,r=So[n.type];r&&this.manager.emit(r,s)},this._onOtherEvent=s=>{this.manager.emit(s.type,s)},this.options={...Wo,...e},this.events=new Map,this.setElement(t);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:e}=this,i=e.Manager;this.manager=new i(t,{touchAction:e.touchAction,recognizers:e.recognizers||yo}).on("hammer.input",this._onBasicInput),e.recognizers||Object.keys(oe).forEach(s=>{const n=this.manager.get(s);n&&oe[s].forEach(r=>{n.recognizeWith(r)})});for(const s in e.recognizerOptions){const n=this.manager.get(s);if(n){const r=e.recognizerOptions[s];delete r.enable,n.set(r)}}this.wheelInput=new ko(t,this._onOtherEvent,{enable:!1}),this.moveInput=new Io(t,this._onOtherEvent,{enable:!1}),this.keyInput=new Do(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new Oo(t,this._onOtherEvent,{enable:!1});for(const[s,n]of this.events)n.isEmpty()||(this._toggleRecognizer(n.recognizerName,!0),this.manager.on(s,n.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,e,i){this._addEventHandler(t,e,i,!1)}once(t,e,i){this._addEventHandler(t,e,i,!0)}watch(t,e,i){this._addEventHandler(t,e,i,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:i}=this;if(!i)return;const s=i.get(t);if(s&&s.options.enable!==e){s.set({enable:e});const n=Eo[t];n&&!this.options.recognizers&&n.forEach(r=>{const a=i.get(r);e?(a.requireFailure(t),s.dropRequireFailure(r)):a.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}_addEventHandler(t,e,i,s,n){if(typeof t!="string"){i=e;for(const d in t)this._addEventHandler(d,t[d],i,s,n);return}const{manager:r,events:a}=this,c=re[t]||t;let l=a.get(c);l||(l=new Xo(this),a.set(c,l),l.recognizerName=bo[c]||c,r&&r.on(c,l.handleEvent)),l.add(t,e,i,s,n),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(t,e){if(typeof t!="string"){for(const r in t)this._removeEventHandler(r,t[r]);return}const{events:i}=this,s=re[t]||t,n=i.get(s);if(n&&(n.remove(t,e),n.isEmpty())){const{recognizerName:r}=n;let a=!1;for(const c of i.values())if(c.recognizerName===r&&!c.isEmpty()){a=!0;break}a||this._toggleRecognizer(r,!1)}}}function F(){}const $o=({isDragging:o})=>o?"grabbing":"grab",Ye={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:F,onResize:F,onViewStateChange:F,onInteractionStateChange:F,onBeforeRender:F,onAfterRender:F,onLoad:F,onError:o=>M.error(o.message,o.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:$o,getTooltip:null,debug:!1,drawPickingColors:!1};class Xe{constructor(t){h(this,"props",void 0),h(this,"width",0),h(this,"height",0),h(this,"userData",{}),h(this,"canvas",null),h(this,"viewManager",null),h(this,"layerManager",null),h(this,"effectManager",null),h(this,"deckRenderer",null),h(this,"deckPicker",null),h(this,"eventManager",null),h(this,"tooltip",null),h(this,"metrics",void 0),h(this,"animationLoop",void 0),h(this,"stats",void 0),h(this,"viewState",void 0),h(this,"cursorState",void 0),h(this,"_needsRedraw",void 0),h(this,"_pickRequest",void 0),h(this,"_lastPointerDownInfo",null),h(this,"_metricsCounter",void 0),h(this,"_onPointerMove",e=>{const{_pickRequest:i}=this;if(e.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(e.leftButton||e.rightButton)return;{const s=e.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=e}),h(this,"_onEvent",e=>{const i=qt[e.type],s=e.offsetCenter;if(!i||!s||!this.layerManager)return;const n=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:n,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:a}=r,c=a&&(a[i.handler]||a.props[i.handler]),l=this.props[i.handler];let d=!1;c&&(d=c.call(a,r,e)),!d&&l&&l(r,e)}),h(this,"_onPointerDown",e=>{const i=e.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo}),this.props={...Ye,...t},t=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},t.viewState&&t.initialViewState&&M.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),Ti()==="IE"&&M.warn("IE 11 is not supported")(),this.viewState=t.initialViewState,t.gl||typeof document<"u"&&(this.canvas=this._createCanvas(t)),this.animationLoop=this._createAnimationLoop(t),this.stats=new Ce({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(t),t._typedArrayManagerProps&&Li.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,e,i,s,n,r,a,c;if((t=this.animationLoop)===null||t===void 0||t.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(i=this.viewManager)===null||i===void 0||i.finalize(),this.viewManager=null,(s=this.effectManager)===null||s===void 0||s.finalize(),this.effectManager=null,(n=this.deckRenderer)===null||n===void 0||n.finalize(),this.deckRenderer=null,(r=this.deckPicker)===null||r===void 0||r.finalize(),this.deckPicker=null,(a=this.eventManager)===null||a===void 0||a.destroy(),this.eventManager=null,(c=this.tooltip)===null||c===void 0||c.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var l;(l=this.canvas.parentElement)===null||l===void 0||l.removeChild(this.canvas),this.canvas=null}}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&M.removed("onLayerHover","onHover")(),"onLayerClick"in t&&M.removed("onLayerClick","onClick")(),t.initialViewState&&!J(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(t),s=this.layerManager.needsRedraw(t),n=this.effectManager.needsRedraw(t),r=this.deckRenderer.needsRedraw(t);return e=e||i||s||n||r,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return this.viewManager!==null}getViews(){return k(this.viewManager),this.viewManager.views}getViewports(t){return k(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,e=!1){for(const i in t)this.layerManager.resourceManager.add({resourceId:i,data:t[i],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_pick(t,e,i){k(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(e).timeStart();const n=this.deckPicker[t]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return s.get(e).timeEnd(),n}_createCanvas(t){let e=t.canvas;return typeof e=="string"&&(e=document.getElementById(e),k(e)),e||(e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(e)),Object.assign(e.style,t.style),e}_setCanvasSize(t){if(!this.canvas)return;const{width:e,height:i}=t;if(e||e===0){const n=Number.isFinite(e)?"".concat(e,"px"):e;this.canvas.style.width=n}if(i||i===0){var s;const n=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((s=t.style)===null||s===void 0?void 0:s.position)||"absolute",this.canvas.style.height=n}}_updateCanvasSize(){var t,e;const{canvas:i}=this;if(!i)return;const s=(t=i.clientWidth)!==null&&t!==void 0?t:i.width,n=(e=i.clientHeight)!==null&&e!==void 0?e:i.height;if(s!==this.width||n!==this.height){var r,a;this.width=s,this.height=n,(r=this.viewManager)===null||r===void 0||r.setProps({width:s,height:n}),(a=this.layerManager)===null||a===void 0||a.activateViewport(this.getViewports()[0]),this.props.onResize({width:s,height:n})}}_createAnimationLoop(t){const{width:e,height:i,gl:s,glOptions:n,debug:r,onError:a,onBeforeRender:c,onAfterRender:l,useDevicePixels:d}=t;return new ks({width:e,height:i,useDevicePixels:d,autoResizeDrawingBuffer:!s,autoResizeViewport:!1,gl:s,onCreateContext:u=>ye({...n,...u,canvas:this.canvas,debug:r,onContextLost:()=>this._onContextLost()}),onInitialize:u=>this._setGLContext(u.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:c,onAfterRender:l,onError:a})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let t=this.props.views||[new Ze({id:"default-view"})];return t=Array.isArray(t)?t:[t],t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:i,emptyInfo:s}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=i.length>0;let n=s,r=!1;for(const a of i){var e;n=a,r=((e=a.layer)===null||e===void 0?void 0:e.onHover(a,t.event))||r}if(!r&&this.props.onHover&&this.props.onHover(n,t.event),this.props.getTooltip&&this.tooltip){const a=this.props.getTooltip(n);this.tooltip.setTooltip(a,n.x,n.y)}t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(t){if(this.layerManager)return;this.canvas||(this.canvas=t.canvas,Se(t,{enable:!0,copyState:!0})),this.tooltip=new _o(this.canvas),H(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);const e=new De;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new Ko(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in qt)this.eventManager.on(s,this._onEvent);this.viewManager=new Xn({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new Yn(t,{deck:this,stats:this.stats,viewport:i,timeline:e}),this.effectManager=new ro,this.deckRenderer=new co(t),this.deckPicker=new mo(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{gl:i}=this.layerManager.context;H(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...e}),this.props.onAfterRender({gl:i})}_onRenderFrame(t){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),M.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const i=Ee.get("Memory Usage");t.bufferMemory=i.get("Buffer Memory").count,t.textureMemory=i.get("Texture Memory").count,t.renderbufferMemory=i.get("Renderbuffer Memory").count,t.gpuMemory=i.get("GPU Memory").count}}h(Xe,"defaultProps",Ye);h(Xe,"VERSION",vs);const ot=Math.PI/180,we=180/Math.PI,at=6370972,Z=256;function Qo(){const o=Z/at,t=Math.PI/180*Z;return{unitsPerMeter:[o,o,o],unitsPerMeter2:[0,0,0],metersPerUnit:[1/o,1/o,1/o],unitsPerDegree:[t,t,o],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,1/o]}}class Jo extends Y{constructor(t={}){const{latitude:e=0,longitude:i=0,zoom:s=0,nearZMultiplier:n=.1,farZMultiplier:r=2,resolution:a=10}=t;let{height:c,altitude:l=1.5}=t;c=c||1,l=Math.max(.75,l);const d=new x().lookAt({eye:[0,-l,0],up:[0,0,1]}),u=Math.pow(2,s);d.rotateX(e*ot),d.rotateZ(-i*ot),d.scale(u/c);const p=Math.atan(.5/l),g=Z*2*u/c;super({...t,height:c,viewMatrix:d,longitude:i,latitude:e,zoom:s,distanceScales:Qo(),fovyRadians:p*2,focalDistance:l,near:n,far:Math.min(2,1/g+1)*l*r}),h(this,"longitude",void 0),h(this,"latitude",void 0),h(this,"resolution",void 0),this.latitude=e,this.longitude=i,this.resolution=a}get projectionMode(){return Te.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(t={}){const e={targetZ:t.z||0},i=this.unproject([0,this.height/2],e),s=this.unproject([this.width/2,0],e),n=this.unproject([this.width,this.height/2],e),r=this.unproject([this.width/2,this.height],e);return n[0]<this.longitude&&(n[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],n[0],s[0],r[0]),Math.min(i[1],n[1],s[1],r[1]),Math.max(i[0],n[0],s[0],r[0]),Math.max(i[1],n[1],s[1],r[1])]}unproject(t,{topLeft:e=!0,targetZ:i}={}){const[s,n,r]=t,a=e?n:this.height-n,{pixelUnprojectionMatrix:c}=this;let l;if(Number.isFinite(r))l=vt(c,[s,a,r,1]);else{const g=vt(c,[s,a,-1,1]),f=vt(c,[s,a,1,1]),m=((i||0)/at+1)*Z,w=mt(Ri([],g,f)),_=mt(g),v=mt(f),E=4*((4*_*v-(w-_-v)**2)/16)/w,S=Math.sqrt(_-E),L=Math.sqrt(Math.max(0,m*m-E)),R=(S-L)/Math.sqrt(w);l=Ci([],g,f,R)}const[d,u,p]=this.unprojectPosition(l);return Number.isFinite(r)?[d,u,p]:Number.isFinite(i)?[d,u,i]:[d,u]}projectPosition(t){const[e,i,s=0]=t,n=e*ot,r=i*ot,a=Math.cos(r),c=(s/at+1)*Z;return[Math.sin(n)*a*c,-Math.cos(n)*a*c,Math.sin(r)*c]}unprojectPosition(t){const[e,i,s]=t,n=ki(t),r=Math.asin(s/n),c=Math.atan2(e,-i)*we,l=r*we,d=(n/Z-1)*at;return[c,l,d]}projectFlat(t){return t}unprojectFlat(t){return t}panByPosition(t,e){const i=this.unproject(e);return{longitude:t[0]-i[0]+this.longitude,latitude:t[1]-i[1]+this.latitude}}}function vt(o,t){const e=xi([],t,o);return Ii(e,e,1/e[3]),e}const Pt=Math.PI/180;function tr({height:o,focalDistance:t,orbitAxis:e,rotationX:i,rotationOrbit:s,zoom:n}){const r=e==="Z"?[0,0,1]:[0,1,0],a=e==="Z"?[0,-t,0]:[0,0,t],c=new x().lookAt({eye:a,up:r});c.rotateX(i*Pt),e==="Z"?c.rotateZ(s*Pt):c.rotateY(s*Pt);const l=Math.pow(2,n)/o;return c.scale(l),c}class er extends Y{constructor(t){const{height:e,projectionMatrix:i,fovy:s=50,orbitAxis:n="Z",target:r=[0,0,0],rotationX:a=0,rotationOrbit:c=0,zoom:l=0}=t,d=i?i[5]/2:Vi(s);super({...t,longitude:void 0,viewMatrix:tr({height:e||1,focalDistance:d,orbitAxis:n,rotationX:a,rotationOrbit:c,zoom:l}),fovy:s,focalDistance:d,position:r,zoom:l}),h(this,"projectedCenter",void 0),this.projectedCenter=this.project(this.center)}unproject(t,{topLeft:e=!0}={}){const[i,s,n=this.projectedCenter[2]]=t,r=e?s:this.height-s,[a,c,l]=At([i,r,n],this.pixelUnprojectionMatrix);return[a,c,l]}panByPosition(t,e){const i=this.project(t),s=[this.width/2+i[0]-e[0],this.height/2+i[1]-e[1],this.projectedCenter[2]];return{target:this.unproject(s)}}}const ir=new x().lookAt({eye:[0,0,1]});function sr({width:o,height:t,near:e,far:i,padding:s}){let n=-o/2,r=o/2,a=-t/2,c=t/2;if(s){const{left:l=0,right:d=0,top:u=0,bottom:p=0}=s,g=y((l+o-d)/2,0,o)-o/2,f=y((u+t-p)/2,0,t)-t/2;n-=g,r-=g,a+=f,c+=f}return new x().ortho({left:n,right:r,bottom:a,top:c,near:e,far:i})}class nr extends Y{constructor(t){const{width:e,height:i,near:s=.1,far:n=1e3,zoom:r=0,target:a=[0,0,0],padding:c=null,flipY:l=!0}=t,d=Array.isArray(r)?r[0]:r,u=Array.isArray(r)?r[1]:r,p=Math.min(d,u),g=Math.pow(2,p);let f;if(d!==u){const m=Math.pow(2,d),w=Math.pow(2,u);f={unitsPerMeter:[m/g,w/g,1],metersPerUnit:[g/m,g/w,1]}}super({...t,longitude:void 0,position:a,viewMatrix:ir.clone().scale([g,g*(l?-1:1),g]),projectionMatrix:sr({width:e||1,height:i||1,padding:c,near:s,far:n}),zoom:p,distanceScales:f})}projectFlat([t,e]){const{unitsPerMeter:i}=this.distanceScales;return[t*i[0],e*i[1]]}unprojectFlat([t,e]){const{metersPerUnit:i}=this.distanceScales;return[t*i[0],e*i[1]]}panByPosition(t,e){const i=At(e,this.pixelUnprojectionMatrix),s=this.projectFlat(t),n=St([],s,Di([],i)),r=St([],this.center,n);return{target:this.unprojectFlat(r)}}}class or extends Y{constructor(t){const{longitude:e,latitude:i,modelMatrix:s,bearing:n=0,pitch:r=0,up:a=[0,0,1]}=t,l=new pt({bearing:n,pitch:r===-90?1e-4:90+r}).toVector3().normalize(),d=s?new x(s).transformAsVector(l):l,u=Number.isFinite(i)?Oi({latitude:i}):0,p=Math.pow(2,u),g=new x().lookAt({eye:[0,0,0],center:d,up:a}).scale(p);super({...t,zoom:u,viewMatrix:g}),h(this,"longitude",void 0),h(this,"latitude",void 0),this.latitude=i,this.longitude=e}}const K=20;class Bt extends Nt{constructor(t){const{width:e,height:i,position:s=[0,0,0],bearing:n=0,pitch:r=0,longitude:a=null,latitude:c=null,maxPitch:l=90,minPitch:d=-90,startRotatePos:u,startBearing:p,startPitch:g,startZoomPosition:f}=t;super({width:e,height:i,position:s,bearing:n,pitch:r,longitude:a,latitude:c,maxPitch:l,minPitch:d},{startRotatePos:u,startBearing:p,startPitch:g,startZoomPosition:f})}panStart(){return this}pan(){return this}panEnd(){return this}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:e=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:n,startPitch:r}=this.getState(),{width:a,height:c}=this.getViewportProps();if(!s||n===void 0||r===void 0)return this;let l;if(t){const d=(t[0]-s[0])/a,u=(t[1]-s[1])/c;l={bearing:n-d*180,pitch:r-u*90}}else l={bearing:n-e,pitch:r-i};return this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startRotatePos:null,startBearing:null,startPitch:null})}zoomStart(){return this._getUpdatedState({startZoomPosition:this.getViewportProps().position})}zoom({scale:t}){let{startZoomPosition:e}=this.getState();e||(e=this.getViewportProps().position);const i=this.getDirection();return this._move(i,Math.log2(t)*K,e)}zoomEnd(){return this._getUpdatedState({startZoomPosition:null})}moveLeft(t=K){const e=this.getDirection(!0);return this._move(e.rotateZ({radians:Math.PI/2}),t)}moveRight(t=K){const e=this.getDirection(!0);return this._move(e.rotateZ({radians:-Math.PI/2}),t)}moveUp(t=K){const e=this.getDirection(!0);return this._move(e,t)}moveDown(t=K){const e=this.getDirection(!0);return this._move(e.negate(),t)}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}zoomIn(t=2){return this.zoom({scale:t})}zoomOut(t=2){return this.zoom({scale:1/t})}shortestPathFrom(t){const e=t.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:n}=i;return Math.abs(s-e.bearing)>180&&(i.bearing=s<0?s+360:s-360),n!==null&&e.longitude!==null&&Math.abs(n-e.longitude)>180&&(i.longitude=n<0?n+360:n-360),i}_move(t,e,i=this.getViewportProps().position){const s=t.scale(e);return this._getUpdatedState({position:new q(i).add(s)})}getDirection(t=!1){return new pt({bearing:this.getViewportProps().bearing,pitch:t?90:90+this.getViewportProps().pitch}).toVector3().normalize()}_getUpdatedState(t){return new Bt({...this.getViewportProps(),...this.getState(),...t})}applyConstraints(t){const{pitch:e,maxPitch:i,minPitch:s,longitude:n,bearing:r}=t;return t.pitch=y(e,s,i),n!==null&&(n<-180||n>180)&&(t.longitude=ht(n+180,360)-180),(r<-180||r>180)&&(t.bearing=ht(r+180,360)-180),t}}class rr extends it{constructor(...t){super(...t),h(this,"ControllerState",Bt),h(this,"transition",{transitionDuration:300,transitionInterpolator:new X(["position","pitch","bearing"])})}}class ar extends et{get ViewportType(){return or}get ControllerType(){return rr}}h(ar,"displayName","FirstPersonView");class We extends Nt{constructor(t){const{width:e,height:i,rotationX:s=0,rotationOrbit:n=0,target:r=[0,0,0],zoom:a=0,minRotationX:c=-90,maxRotationX:l=90,minZoom:d=-1/0,maxZoom:u=1/0,startPanPosition:p,startRotatePos:g,startRotationX:f,startRotationOrbit:m,startZoomPosition:w,startZoom:_}=t;super({width:e,height:i,rotationX:s,rotationOrbit:n,target:r,zoom:a,minRotationX:c,maxRotationX:l,minZoom:d,maxZoom:u},{startPanPosition:p,startRotatePos:g,startRotationX:f,startRotationOrbit:m,startZoomPosition:w,startZoom:_}),h(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanPosition:this._unproject(t)})}pan({pos:t,startPosition:e}){const i=this.getState().startPanPosition||e;if(!i)return this;const n=this.makeViewport(this.getViewportProps()).panByPosition(i,t);return this._getUpdatedState(n)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:t,deltaAngleX:e=0,deltaAngleY:i=0}){const{startRotatePos:s,startRotationX:n,startRotationOrbit:r}=this.getState(),{width:a,height:c}=this.getViewportProps();if(!s||n===void 0||r===void 0)return this;let l;if(t){let d=(t[0]-s[0])/a;const u=(t[1]-s[1])/c;(n<-90||n>90)&&(d*=-1),l={rotationX:n+u*180,rotationOrbit:r+d*180}}else l={rotationX:n+i,rotationOrbit:r+e};return this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(t){const e=t.getViewportProps(),i={...this.getViewportProps()},{rotationOrbit:s}=i;return Math.abs(s-e.rotationOrbit)>180&&(i.rotationOrbit=s<0?s+360:s-360),i}zoomStart({pos:t}){return this._getUpdatedState({startZoomPosition:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:e,scale:i}){let{startZoom:s,startZoomPosition:n}=this.getState();if(n||(s=this.getViewportProps().zoom,n=this._unproject(e)||this._unproject(t)),!n)return this;const r=this._calculateNewZoom({scale:i,startZoom:s}),a=this.makeViewport({...this.getViewportProps(),zoom:r});return this._getUpdatedState({zoom:r,...a.panByPosition(n,t)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(t=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:t})})}zoomOut(t=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/t})})}moveLeft(t=50){return this._panFromCenter([-t,0])}moveRight(t=50){return this._panFromCenter([t,0])}moveUp(t=50){return this._panFromCenter([0,-t])}moveDown(t=50){return this._panFromCenter([0,t])}rotateLeft(t=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-t})}rotateRight(t=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+t})}rotateUp(t=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-t})}rotateDown(t=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_calculateNewZoom({scale:t,startZoom:e}){const{maxZoom:i,minZoom:s}=this.getViewportProps();e===void 0&&(e=this.getViewportProps().zoom);const n=e+Math.log2(t);return y(n,s,i)}_panFromCenter(t){const{width:e,height:i,target:s}=this.getViewportProps();return this.pan({startPosition:s,pos:[e/2+t[0],i/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}applyConstraints(t){const{maxZoom:e,minZoom:i,zoom:s,maxRotationX:n,minRotationX:r,rotationOrbit:a}=t;return t.zoom=Array.isArray(s)?[y(s[0],i,e),y(s[1],i,e)]:y(s,i,e),t.rotationX=y(t.rotationX,r,n),(a<-180||a>180)&&(t.rotationOrbit=ht(a+180,360)-180),t}}class hr extends it{constructor(...t){super(...t),h(this,"ControllerState",We),h(this,"transition",{transitionDuration:300,transitionInterpolator:new X({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})})}}class cr extends et{constructor(t={}){super(t),this.props.orbitAxis=t.orbitAxis||"Z"}get ViewportType(){return er}get ControllerType(){return hr}}h(cr,"displayName","OrbitView");class lr extends We{constructor(t){super(t),h(this,"zoomAxis",void 0),this.zoomAxis=t.zoomAxis||"all"}_calculateNewZoom({scale:t,startZoom:e}){const{maxZoom:i,minZoom:s}=this.getViewportProps();e===void 0&&(e=this.getViewportProps().zoom);let n=Math.log2(t);if(Array.isArray(e)){let[r,a]=e;switch(this.zoomAxis){case"X":r=y(r+n,s,i);break;case"Y":a=y(a+n,s,i);break;default:let c=Math.min(r+n,a+n);c<s&&(n+=s-c),c=Math.max(r+n,a+n),c>i&&(n+=i-c),r+=n,a+=n}return[r,a]}return y(e+n,s,i)}}class dr extends it{constructor(...t){super(...t),h(this,"ControllerState",lr),h(this,"transition",{transitionDuration:300,transitionInterpolator:new X(["target","zoom"])}),h(this,"dragMode","pan")}_onPanRotate(){return!1}}class ur extends et{get ViewportType(){return nr}get ControllerType(){return dr}}h(ur,"displayName","OrthographicView");class pr extends Ge{applyConstraints(t){const{maxZoom:e,minZoom:i,zoom:s}=t;t.zoom=y(s,i,e);const{longitude:n,latitude:r}=t;return(n<-180||n>180)&&(t.longitude=ht(n+180,360)-180),t.latitude=y(r,-89,89),t}}class gr extends it{constructor(...t){super(...t),h(this,"ControllerState",pr),h(this,"transition",{transitionDuration:300,transitionInterpolator:new X(["longitude","latitude","zoom"])}),h(this,"dragMode","pan")}setProps(t){super.setProps(t),this.dragRotate=!1,this.touchRotate=!1}}class fr extends et{get ViewportType(){return Jo}get ControllerType(){return gr}}h(fr,"displayName","GlobeView");class Ke{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(t){h(this,"opts",void 0),t&&(this.opts=t)}equals(t){return this===t?!0:this.constructor===t.constructor&&J(this.opts,t.opts,1)}getShaders(t){return null}getSubLayerProps(t){const{defaultProps:e}=t.constructor,i={updateTriggers:{}};for(const s in e)if(s in this.props){const n=e[s],r=this.props[s];i[s]=r,n&&n.type==="accessor"&&(i.updateTriggers[s]=this.props.updateTriggers[s],typeof r=="function"&&(i[s]=this.getSubLayerAccessor(r)))}return i}initializeState(t,e){}updateState(t,e){}onNeedsRedraw(t){}getNeedsPickingBuffer(t){return!1}draw(t,e){}finalizeState(t,e){}}h(Ke,"defaultProps",{});h(Ke,"extensionName","LayerExtension");const yt={bearing:0,pitch:0,position:[0,0,0]},mr={speed:1.2,curve:1.414};class yr extends je{constructor(t={}){super({compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),h(this,"opts",void 0),this.opts={...mr,...t}}interpolateProps(t,e,i){const s=Ws(t,e,i,this.opts);for(const n in yt)s[n]=Tt(t[n]||yt[n],e[n]||yt[n],i);return s}getDuration(t,e){let{transitionDuration:i}=e;return i==="auto"&&(i=Ks(t,e,this.opts)),i}}export{Ns as AmbientLight,br as AttributeManager,bt as COORDINATE_SYSTEM,Mr as CompositeLayer,it as Controller,Xe as Deck,co as DeckRenderer,kt as DirectionalLight,rr as FirstPersonController,ar as FirstPersonView,or as FirstPersonViewport,yr as FlyToInterpolator,Tr as Layer,Ke as LayerExtension,Yn as LayerManager,Ue as LightingEffect,X as LinearInterpolator,so as MapController,Ze as MapView,Lr as OPERATION,hr as OrbitController,cr as OrbitView,er as OrbitViewport,dr as OrthographicController,ur as OrthographicView,nr as OrthographicViewport,fn as PointLight,Pr as PostProcessEffect,xt as TRANSITION_EVENTS,Rr as Tesselator,je as TransitionInterpolator,Cr as UNIT,vs as VERSION,et as View,Y as Viewport,bi as WebMercatorViewport,_r as _CameraLight,gr as _GlobeController,fr as _GlobeView,Jo as _GlobeViewport,Ft as _LayersPass,Be as _PickLayersPass,vr as _SunLight,kr as _compareProps,xr as _count,J as _deepEqual,Ir as _fillArray,ke as _flatten,Le as _memoize,Vr as _mergeShaders,k as assert,Dr as createIterable,Or as fp64LowPart,Ar as gouraudLighting,M as log,zr as phongLighting,Fr as picking,Me as project,Nr as project32,wt as shadow};
